[build]
builder = "railpack"
setupCommand = """
  apt-get update && \
  apt-get install -y openjdk-17-jdk && \
  export JAVA_HOME=/usr/lib/jvm/java-17-openjdk-amd64 && \
  export PATH=$JAVA_HOME/bin:$PATH && \
  chmod +x gradlew && \
  java -version
"""
buildCommand = """
  export JAVA_HOME=/usr/lib/jvm/java-17-openjdk-amd64 && \
  export PATH=$JAVA_HOME/bin:$PATH && \
  ./gradlew build -x test --no-daemon --stacktrace
"""

[start]
cmd = """
  export JAVA_HOME=/usr/lib/jvm/java-17-openjdk-amd64 && \
  export PATH=$JAVA_HOME/bin:$PATH && \
  java -Dserver.port=$PORT -Dspring.profiles.active=prod -jar build/libs/iStudy-0.0.1-SNAPSHOT.jar
"""

[variables]
JAVA_HOME = "/usr/lib/jvm/java-17-openjdk-amd64"
JAVA_VERSION = "17"
SPRING_PROFILES_ACTIVE = "prod"

[deploy]
healthcheckPath = "/actuator/health"
healthcheckTimeout = 300
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10