[build]
builder = "railpack"
setupCommand = """
  apt-get update && \
  apt-get install -y openjdk-17-jdk && \
  export JAVA_HOME=$(readlink -f /usr/bin/java | sed "s:bin/java::") && \
  echo "JAVA_HOME is: $JAVA_HOME" && \
  chmod +x gradlew
"""
buildCommand = """
  export JAVA_HOME=$(readlink -f /usr/bin/java | sed "s:bin/java::") && \
  export PATH=$JAVA_HOME/bin:$PATH && \
  java -version && \
  ./gradlew build -x test --no-daemon --stacktrace
"""

[start]
cmd = "java -Dserver.port=$PORT -Dspring.profiles.active=prod -jar build/libs/iStudy-0.0.1-SNAPSHOT.jar"

[variables]
SPRING_PROFILES_ACTIVE = "prod"

[deploy]
healthcheckPath = "/actuator/health"
healthcheckTimeout = 300
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10